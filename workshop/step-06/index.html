<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 6 - Configure the Stylesheet - Te Ara Hura Workshop</title>
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Overpass:wght@300;400;600&family=Overpass+Mono:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../workshop.css">
</head>
<body>
  <div class="workshop-container">
    <aside class="workshop-sidebar">
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <span class="toggle-icon">☰</span>
      </button>
      <div class="sidebar-content" id="sidebarContent">
        <div class="sidebar-logo">
          <img src="../images/foss4g2025-logo.svg" alt="FOSS4G 2025" class="logo">
        </div>
        <div class="sidebar-header">
          <h2><a href="../welcome/" class="sidebar-header-link">Standalone Web Maps, No Platform Required</a></h2>
        </div>
        <nav class="sidebar-nav">
          
            
            
              <a href="../step-01/" class="sidebar-item">
            
              <span class="step-number">Step 1</span>
              <span class="step-title">Get Set Up</span>
            </a>
          
            
            
              <a href="../step-02/" class="sidebar-item">
            
              <span class="step-number">Step 2</span>
              <span class="step-title">Use Overpass to Create an OpenStreetMap Extract</span>
            </a>
          
            
            
              <a href="../step-03/" class="sidebar-item">
            
              <span class="step-number">Step 3</span>
              <span class="step-title">Use Maplibre to Render Your Map</span>
            </a>
          
            
            
              <a href="../step-04/" class="sidebar-item">
            
              <span class="step-number">Step 4</span>
              <span class="step-title">Initialize GitHub Pages to Display Your Map</span>
            </a>
          
            
            
              <a href="../step-05/" class="sidebar-item">
            
              <span class="step-number">Step 5</span>
              <span class="step-title">Download Reference Layers from Protomaps</span>
            </a>
          
            
            
              <a href="./" class="sidebar-item active">
            
              <span class="step-number">Step 6</span>
              <span class="step-title">Configure the Stylesheet</span>
            </a>
          
            
            
              <a href="../step-07/" class="sidebar-item">
            
              <span class="step-number">Step 7</span>
              <span class="step-title">Add Terrain (Hillshade, Contours)</span>
            </a>
          
            
            
              <a href="../step-08/" class="sidebar-item">
            
              <span class="step-number">Step 8</span>
              <span class="step-title">Add Interactivity</span>
            </a>
          
          
            <div class="sidebar-divider"></div>
            <div class="sidebar-label">Bonus Steps</div>
            
          
        </nav>
      </div>
    </aside>

    <main class="workshop-main">
      <article class="workshop-content">
        
          <h1>Step 6 - Configure the Stylesheet</h1>
        
        
        
        <p>Now we'll update our Maplibre to load PMtiles support, and configure the stylesheet to match the Protomaps tiles we downloaded.</p>
<h2>Configure the Stylesheet</h2>
<p>Now we need to modify our stylesheet <code>style.json</code> to:</p>
<ul>
<li>Use the local PMTiles file</li>
<li>Show the Protomaps basemap layers</li>
<li>Also show your existing trail layer</li>
</ul>
<h3>View the Protomaps Stylesheet in Maputnik</h3>
<p>Maputnik allows you to edit the style layers in a GUI, which is helpful since the stylesheet is otherwise over 12,000 lines of JSON when formatted in your text editor.</p>
<p>Maputnik also allows you to make changes and see the results live, without having to switch windows or refresh a browser pane. This is particularly helpful when you are developing a style layer from scratch.</p>
<p>Maputnik is <a rel="noreferrer" target="_blank" href="https://github.com/maplibre/maputnik">maintained by Maplibre</a> as a way of making it easier to understand available style parameters.</p>
<ol>
<li><strong>Go to <a rel="noreferrer" target="_blank" href="https://maplibre.org/maputnik/">https://maplibre.org/maputnik/</a></strong> to view the Maputnik style editor.</li>
<li><strong>Load the Protomaps Light style</strong> under Open &gt; Gallery Styles &gt; Protomaps Light.</li>
<li><strong>Zoom in on Auckland</strong> and then find Waiheke Island in the map panel on the right</li>
<li><strong>Change from Map to Inspect</strong> from the drop-down in the top bar, this will allow you to hover and see all of the tile layers and attributes</li>
<li><strong>Change back from Inspect to Map</strong> from the drop-down in the top bar</li>
<li><strong>Click on Expand</strong> in the top left corner to see all the map layers</li>
</ol>
<p>You should now see the fully expanded list of layers defined in the Protomaps stylesheet. It is a lot!</p>
<p><strong>Note: Maplibre renders these layers in order from top to bottom, so the last layer in the list will render on top.</strong></p>
<p>The position a layer has in the render order is commonly referred to as the <strong>z-order</strong></p>
<p>Observe the z-orders of various layers in this stylesheet. For any basemap the order will generally be:</p>
<ul>
<li>Landcover (areas) on the bottom</li>
<li>Roads / Streams (lines) in the middle</li>
<li>Labels and Icons (points) on the top</li>
</ul>
<h3>Add Te Ara Hura</h3>
<p>We're going to use Maputnik to add the trail styles from <code>style.json</code> in Step 3 into the Protomaps style sheet here.</p>
<p>Here's the <code>style.json</code> from Step 3:</p>
<pre><code class="language-json">{
  "version": 8,
  "sources": {
    "te-ara-hura": {
      "type": "geojson",
      "data": "sources/te_ara_hura.geojson"
    }
  },
  "layers": [
    {
      "id": "trail-line",
      "type": "line",
      "source": "te-ara-hura",
      "paint": {
        "line-color": "#e41f18",
        "line-width": 3,
        "line-dasharray": [2, 2]
      }
    }
  ]
}
</code></pre>
<h4>Add the GeoJSON Source</h4>
<p><strong>Important for Codespaces users</strong>: You need to make your port public so Maputnik can access your server. In the Codespaces "Ports" tab, right-click on port 1234 (or click the globe icon) and select "Port Visibility" → "Public". This allows Maputnik to access your GeoJSON and other files.</p>
<ol>
<li>
<p><strong>Click on Data Sources</strong> in the top bar of Maputnik. In the panel that pops up, you will see #protomaps listed under <strong>Active Sources</strong></p>
</li>
<li>
<p><strong>Add New Source</strong> at the bottom of the panel. Here you are going to input the fields from the <code>style.json</code> we introduced in Step 3.</p>
<ul>
<li><code>Source ID</code> is <code>te-ara-hura</code></li>
<li>Under <code>Source Type</code> use the drop-down to select "GeoJSON (URL)"</li>
<li>Go to the browser tab where you are previewing your map either locally and in codespaces, and type <code>sources/te_ara_hura.geojson</code> at the end of the URL to verify you can see the GeoJSON file there.</li>
<li>If not, restart Caddy</li>
<li>Ctrl+C or Cmd+C to copy the URL to your clipboard</li>
<li>Under <code>URL</code> paste:
<ul>
<li><strong>If using local Caddy</strong>: it will look like <code>http://127.0.0.1:1234/sources/te_ara_hura.geojson</code></li>
<li><strong>If using GitHub Codespaces</strong>: it will look like <code>https://xxxxx-1234.preview.app.github.dev/sources/te_ara_hura.geojson</code>)</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4>Add a Trail Layer</h4>
<ol>
<li>
<p><strong>Click "Add Layer"</strong> at the top of the list of layers</p>
</li>
<li>
<p><strong>Input the id, type, and source</strong> as defined in the <code>style.json</code> from Step 3</p>
</li>
<li>
<p><strong>Input the color, width and dasharray</strong> as defined in the <code>style.json</code> from Step 3</p>
</li>
<li>
<p><strong>Scroll to the JSON Editor</strong> at the bottom of the Add Layer panel. Click the &gt; to expand.</p>
</li>
</ol>
<p>You should see a layer definition like this. If you don't, you can copy and paste this in:</p>
<pre><code class="language-json">    {
      "id": "trail-line",
      "type": "line",
      "source": "te-ara-hura",
      "paint": {
        "line-color": "#e41f18",
        "line-width": 3,
        "line-dasharray": [2, 2]
      }
    }
</code></pre>
<p>You should also see the trail as a red dashed line circling Waiheke Island.</p>
<h4>Adjust the Z-Order</h4>
<p>Let's fix the fact that the red dashed trail line is currently rendering on top of all our labels, and bisecting the Waiheke Island Aerodrome.</p>
<ol>
<li>
<p><strong>Note the symbols at the start of each layer</strong>: diamond for area layers, squiggle for line layers, marker for point layers.</p>
</li>
<li>
<p><strong>Find the layer you just created</strong> at the bottom of the list of layers. Note the squiggle next to it, because this is a line layer</p>
</li>
<li>
<p><strong>Drag Te Ara Hura</strong> to group it as the last of the line layers, so that it renders on top of roads and rivers, but under the labels.</p>
</li>
</ol>
<h4>Export, Save and Edit</h4>
<p>Now we are going to save the stylesheet you created in Maputnik to your local copy of the workshop repo (e.g. not in Codespaces).</p>
<p><strong>Important</strong>: If you're working locally and have made changes in Codespaces (or vice versa), update your local repository in VS Code before overwriting <code>style.json</code>:</p>
<ul>
<li><strong>Using VS Code GUI</strong>: Open the Source Control panel (View → Source Control, or <code>Ctrl+Shift+G</code> / <code>Cmd+Shift+G</code>), click the <code>...</code> menu, and select "Pull"</li>
<li><strong>Using command line</strong>: Open the terminal (View → Terminal) and run <code>git pull</code></li>
</ul>
<p>Now you're ready to save your stylesheet:</p>
<ol>
<li>
<p><strong>Click "Save" at the top</strong> to save this stylesheet back into the repo. You can name it <code>style.json</code> and overwrite the earlier file at this point.</p>
</li>
<li>
<p><strong>Open <code>style.json</code> as a text file</strong> and adjust the addresses for your <code>sources</code>, <code>glyphs</code>, and <code>fonts</code></p>
<ul>
<li>Remove the server address (either <code>http://127.0.0.1:1234/</code> for local Caddy or your Codespaces forwarded URL) from the url for the Te Ara Hura GeoJSON under <code>sources</code></li>
<li>Replace the <code>glyphs</code> address with <code>lib/fonts/{fontstack}/{range}.pbf</code> to reference the fonts in your repo</li>
<li>Replace the <code>sprite</code> address with <code>https://YOUR-USERNAME.github.io/standalone_web_maps_foss4g2025/lib/sprite/light</code> where `YOUR-USERNAME is your github handle</li>
<li>Confirm the attribution for Protomaps and OpenStreetMap</li>
</ul>
</li>
<li>
<p><strong>Check the final result</strong>, it should look like the JSON below.</p>
</li>
</ol>
<pre><code class="language-json">{
  "version": 8,
  "name": "style@4.3.0 theme@light lang@en",
  "sources": {
    "te-ara-hura": {
      "type": "geojson",
      "data": "sources/te_ara_hura.geojson"
    },
    "protomaps": {
      "type": "vector",
      "url": "pmtiles://sources/waiheke_island.pmtiles",
      "attribution": "© &lt;a href=\"https://openstreetmap.org\" target=\"_blank\" rel=\"noopener noreferrer\"&gt;OpenStreetMap&lt;/a&gt;"
    }
  },
  "sprite": "https://YOUR-USERNAME.github.io/standalone_web_maps_foss4g2025/lib/sprite/light",
  "glyphs": "lib/fonts/{fontstack}/{range}.pbf",
  "layers": [
   ...
  ],
}
</code></pre>
<ol start="4">
<li><strong>Save your changes</strong></li>
</ol>
<h3>Test Your Map</h3>
<p><strong>If you saved <code>style.json</code> locally and are testing in Codespaces</strong>: First commit and push your local changes, then pull them in Codespaces:</p>
<ol>
<li>
<p><strong>In your local VS Code</strong>: Commit and push your <code>style.json</code> changes</p>
<ul>
<li><strong>Using VS Code GUI</strong>: Open Source Control panel, stage <code>style.json</code>, enter a commit message, and click "Commit", then "Sync Changes" (or "Push")</li>
<li><strong>Using command line</strong>: Run <code>git add style.json</code>, <code>git commit -m "Update style.json with Protomaps configuration"</code>, then <code>git push</code></li>
</ul>
</li>
<li>
<p><strong>In Codespaces</strong>: Pull the latest changes</p>
<ul>
<li><strong>Using VS Code GUI</strong>: Open Source Control panel, click the <code>...</code> menu, and select "Pull"</li>
<li><strong>Using command line</strong>: Run <code>git pull</code></li>
</ul>
</li>
</ol>
<p>Now test your map:</p>
<ol>
<li>
<p><strong>Check to make sure your server is still running</strong>, if not type <code>caddy run</code> in a terminal window (from your repository root directory).</p>
</li>
<li>
<p><strong>Refresh your browser</strong>:</p>
<ul>
<li><strong>If using local Caddy</strong>: Go to <code>http://127.0.0.1:1234/index.html</code></li>
<li><strong>If using GitHub Codespaces</strong>: Use your forwarded URL (e.g., <code>https://xxxxx-1234.preview.app.github.dev/index.html</code>)</li>
</ul>
</li>
<li>
<p><strong>You should see</strong> no change yet! Verify you still see the trail line. We have to define the styles for the PMTiles Protomaps layers before they will show up.</p>
</li>
</ol>
<h3>Add PMTiles Support</h3>
<p>Update your <code>index.html</code> to load PMTiles support.</p>
<ol>
<li><strong>Add the <code>src</code> link for the PMTiles library</strong> stored in <code>lib/</code>. Add it to the <code>&lt;head&gt;</code> section, just below the local copies of Maplibre GL JS, and notice they are structured similarly.</li>
</ol>
<pre><code class="language-html">   &lt;head&gt;
      &lt;meta charset="UTF-8"&gt;
      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
      &lt;title&gt;Te Ara Hura Trail Map&lt;/title&gt;
      
      &lt;!-- Local copies of MapLibre GL JS --&gt;
      &lt;script src="lib/maplibre-gl.5.10.0.js"&gt;&lt;/script&gt;
      &lt;link href="lib/maplibre-gl.5.10.0.css" rel="stylesheet" /&gt;

      &lt;!-- PMTiles support --&gt;
      &lt;script src="lib/pmtiles.4.3.0.js"&gt;&lt;/script&gt;
</code></pre>
<ol start="2">
<li><strong>Activate the PMTiles protocol</strong> by adding these lines just above where the map is defined:</li>
</ol>
<pre><code class="language-html">&lt;script&gt;
  // Initialize PMTiles protocol
   const protocol = new pmtiles.Protocol();
   maplibregl.addProtocol("pmtiles", protocol.tile);

   // Javascript to create a new map using Maplibre GL JS
   const map = new maplibregl.Map({
      ...})
&lt;/script&gt;
</code></pre>
<ol start="3">
<li><strong>Save your changes</strong></li>
</ol>
<h3>Test Your Map</h3>
<ol>
<li>
<p><strong>Check to make sure your server is still running</strong>, if not type <code>caddy run</code> in a terminal window (from your repository root directory).</p>
</li>
<li>
<p><strong>Refresh your browser</strong>:</p>
<ul>
<li><strong>If using local Caddy</strong>: Go to <code>http://127.0.0.1:1234/index.html</code></li>
<li><strong>If using GitHub Codespaces</strong>: Use your forwarded URL (e.g., <code>https://xxxxx-1234.preview.app.github.dev/index.html</code>)</li>
</ul>
</li>
<li>
<p><strong>You should see</strong>:</p>
<ul>
<li>The Protomaps basemap (roads, labels, landcover)</li>
<li>Proper styling with icons and fonts</li>
<li>The Te Ara Hura trail displayed on top</li>
</ul>
</li>
</ol>
<h3>Troubleshooting</h3>
<p><strong>Map doesn't load?</strong></p>
<ul>
<li>Check developer console for errors</li>
<li>Verify <code>style.json</code> exists in root directory</li>
<li>Verify file paths in stylesheet are correct</li>
</ul>
<p><strong>PMTiles not loading?</strong></p>
<ul>
<li>Verify <code>sources/waiheke_island.pmtiles</code> exists</li>
<li>Check that PMTiles protocol is initialized in <code>index.js</code></li>
<li>Verify the PMTiles URL in <code>style.json</code> uses <code>pmtiles://</code> protocol</li>
</ul>
<h3>Verify Your Directory Structure</h3>
<p>You should now have all the files you need to render the map. Double-check it looks like this:</p>
<pre><code>standalone_web_maps_foss4g2025/
├── README.md                    # This file
├── Makefile                     # Build and serve commands (uses Caddy)
├── index.html                   # Main HTML file for the web map (contains inline CSS and JavaScript)
├── style.json                   # Source and style for Te Ara Hura and the Protomaps tile layers, fonts and sprites
├── lib/                         # Third-party libraries (self-contained)
└── sources/                     # Source data files
    ├── waiheke_island.pmtiles   # PMTiles archive for Waiheke Island basemap - added in later steps
    └── te_ara_hura.geojson      # GeoJSON file for Te Ara Hura trail
</code></pre>
<h3>Commit Your Changes</h3>
<p>Add, commit, and push your revised <code>index.html</code> and <code>style.json</code> to your remote fork.</p>
<p><strong>Note for Codespaces users</strong>: Commit these changes in your Codespaces environment using the terminal or Source Control panel.</p>
<p>Verify that the map you see via your server (local or Codespaces) and the one you see via GitHub Pages match the image below.</p>
<h3>What You Have Now</h3>
<p>At the end of this step, you should have:</p>
<ul>
<li><code>style.json</code> - Protomaps bassemap styls and your trail layer style</li>
<li>Map displaying Protomaps basemap with your trail layer</li>
</ul>

        
          <div class="map-preview-container">
  <h2>Your Map Preview</h2>
  <div class="map-preview-wrapper">
    <img src="../images/step-06.png" alt="Map preview showing expected result at this stage" class="map-preview-image" style="max-width: 100%; height: auto; border: 1px solid #dee2e6; border-radius: 4px;">
    
      <p class="map-note">This is what your map should look like when you view it in Maputnik</p>
    
  </div>
</div>


        
        
        <hr>
<p><strong><a href="../step-05/">← Previous: Step 5</a> | <a href="../step-07/">Next: Step 7 - Add Terrain →</a></strong></p>
      </article>
    </main>
  </div>

  <footer class="workshop-footer">
    <p>FOSS4G 2025 Workshop - <a rel="noreferrer" target="_blank" href="https://talks.osgeo.org/foss4g-2025/speaker/7A883D/">Stephanie May</a></p>
    <p class="footer-attribution">
      Background image: <a rel="noreferrer" target="_blank" href="https://www.flickr.com/photos/4nitsirk/5624277298" title="The sun returns to Waiheke Island">The sun returns to Waiheke Island</a> by <a rel="noreferrer" target="_blank" href="https://www.flickr.com/photos/4nitsirk/">Kristina D.C. Hoeppner</a>, <a target="_blank" href="https://creativecommons.org/licenses/by-sa/2.0/deed.en" rel="noreferrer">CC BY-SA 2.0</a>
    </p>
  </footer>

  <script>
    // Toggle sidebar on mobile
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarContent = document.getElementById('sidebarContent');
    
    if (sidebarToggle && sidebarContent) {
      sidebarToggle.addEventListener('click', function() {
        const sidebar = sidebarContent.closest('.workshop-sidebar');
        if (sidebar) {
          sidebar.classList.toggle('open');
        }
        sidebarContent.classList.toggle('open');
        sidebarToggle.classList.toggle('active');
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        if (window.innerWidth <= 768) {
          if (!sidebarContent.contains(event.target) && !sidebarToggle.contains(event.target)) {
            sidebarContent.classList.remove('open');
            sidebarToggle.classList.remove('active');
          }
        }
      });
    }
  </script>
</body>
</html>


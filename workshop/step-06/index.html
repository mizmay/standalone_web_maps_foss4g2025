<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 6 - Configure the Stylesheet - Te Ara Hura Workshop</title>
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Overpass:wght@300;400;600&family=Overpass+Mono:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../workshop.css">
</head>
<body>
  <div class="workshop-container">
    <aside class="workshop-sidebar">
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <span class="toggle-icon">☰</span>
      </button>
      <div class="sidebar-content" id="sidebarContent">
        <div class="sidebar-logo">
          <img src="../images/foss4g2025-logo.svg" alt="FOSS4G 2025" class="logo">
        </div>
        <div class="sidebar-header">
          <h2><a href="../welcome/" class="sidebar-header-link">Standalone Web Maps, No Platform Required</a></h2>
        </div>
        <nav class="sidebar-nav">
          
            
            
              <a href="../step-01/" class="sidebar-item">
            
              <span class="step-number">Step 1</span>
              <span class="step-title">Get Set Up</span>
            </a>
          
            
            
              <a href="../step-02/" class="sidebar-item">
            
              <span class="step-number">Step 2</span>
              <span class="step-title">Use Overpass to Create an OpenStreetMap Extract</span>
            </a>
          
            
            
              <a href="../step-03/" class="sidebar-item">
            
              <span class="step-number">Step 3</span>
              <span class="step-title">Use Maplibre to Render Your Map</span>
            </a>
          
            
            
              <a href="../step-04/" class="sidebar-item">
            
              <span class="step-number">Step 4</span>
              <span class="step-title">Initialize GitHub Pages to Display Your Map</span>
            </a>
          
            
            
              <a href="../step-05/" class="sidebar-item">
            
              <span class="step-number">Step 5</span>
              <span class="step-title">Download Reference Layers from Protomaps</span>
            </a>
          
            
            
              <a href="./" class="sidebar-item active">
            
              <span class="step-number">Step 6</span>
              <span class="step-title">Configure the Stylesheet</span>
            </a>
          
            
            
              <a href="../step-07/" class="sidebar-item">
            
              <span class="step-number">Step 7</span>
              <span class="step-title">Add Terrain (Hillshade, Contours)</span>
            </a>
          
            
            
              <a href="../step-08/" class="sidebar-item">
            
              <span class="step-number">Step 8</span>
              <span class="step-title">Add Interactivity</span>
            </a>
          
          
            <div class="sidebar-divider"></div>
            <div class="sidebar-label">Bonus Steps</div>
            
          
        </nav>
      </div>
    </aside>

    <main class="workshop-main">
      <article class="workshop-content">
        
          <h1>Step 6 - Configure the Stylesheet</h1>
        
        
        
        <h2>Configure the Stylesheet</h2>
<p>Now we'll update our Maplibre to load PMtiles support, and configure the stylesheet to match the Protomaps tiles we downloaded.</p>
<h3>Add PMTiles Support</h3>
<p>Update your <code>index.html</code> to load PMTiles support.</p>
<ol>
<li><strong>Add the <code>src</code> link for the PMTiles library</strong> stored in <code>lib/</code>. Add it to the <code>&lt;head&gt;</code> section, just below the local copies of Maplibre GL JS, and notice they are structured similarly.</li>
</ol>
<pre><code class="language-html">   &lt;head&gt;
      &lt;meta charset="UTF-8"&gt;
      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
      &lt;title&gt;Te Ara Hura Trail Map&lt;/title&gt;
      
      &lt;!-- Local copies of MapLibre GL JS --&gt;
      &lt;script src="lib/maplibre-gl.5.10.0.js"&gt;&lt;/script&gt;
      &lt;link href="lib/maplibre-gl.5.10.0.css" rel="stylesheet" /&gt;

      &lt;!-- PMTiles support --&gt;
      &lt;script src="lib/pmtiles.4.3.0.js"&gt;&lt;/script&gt;
</code></pre>
<ol start="2">
<li><strong>Activate the PMTiles protocol</strong> by adding these lines just above where the map is defined:</li>
</ol>
<script>
  // Initialize PMTiles protocol
   const protocol = new pmtiles.Protocol();
   maplibregl.addProtocol("pmtiles", protocol.tile);

   // Javascript to create a new map using Maplibre GL JS
   const map = new maplibregl.Map({
      ...})
</script>
<ol start="3">
<li><strong>Save your changes</strong></li>
</ol>
<h3>Test Your Map</h3>
<ol>
<li>
<p><strong>Check to make sure your local server is still running</strong>, if not type <code>caddy run</code> in a terminal window (from your repository root directory).</p>
</li>
<li>
<p><strong>Refresh your browser</strong>: Go to <code>http://127.0.0.1:1234/index.html</code></p>
</li>
<li>
<p><strong>You should see</strong> no change yet! Verify you still see the trail line. We have to define the styles for the PMTiles Protomaps layers before they will show up.</p>
</li>
</ol>
<h3>Combine the Stylesheets</h3>
<p>Now we need to modify our stylesheet <code>style.json</code> to:</p>
<ul>
<li>Use the local PMTiles file</li>
<li>Show the Protomaps basemap layers</li>
<li>Also show your existing trail layer</li>
</ul>
<p>The instructions below will walk you through how to edit style JSONs directly. We won't do much of this, because editing raw JSON is not for the faint of heart, and if you break the JSON syntax, your map will not load.</p>
<p>If you are using it, VS Code will register an error for bad syntax, so save often and pay attention.</p>
<ol>
<li>
<p><strong>Open <code>protomaps.5.7.0.json</code> in your text editor</strong> and give the stylesheet a name attribute set to the current file name:</p>
<pre><code class="language-json">{
  "version": 8,
  "name": "protomaps v4 5.7.0",
  "sources": { ...}
}
</code></pre>
</li>
<li>
<p><strong>Replace the protomaps URL</strong> with <code>pmtiles:///sources/waiheke_island.pmtiles</code>, to reference our custom extract.</p>
<p>You will find the URL under sources. The final result should look like this:</p>
<pre><code class="language-json">{
  "version": 8,
  "name": "protomaps v4 5.7.0",
  "sources": {
      "protomaps": {
         "type": "raster",
         "url": "pmtiles:///sources/waiheke_island.pmtiles",
         "tileSize": 512
      }
  },
  "layers": [
    // ... existing Protomaps layers ...
  ]
}
</code></pre>
</li>
<li>
<p><strong>Add your trail source</strong> "te-ara-hura" as shown below, be sure to add a comma after the <code>protomaps</code> source:</p>
<pre><code class="language-json">{
  "version": 8,
  "name": "protomaps.5.7.0",
  "glyphs": "/lib/fonts/{fontstack}/{range}.pbf",
  "sprite": "/lib/sprites/sprite",
  "sources": {
      "protomaps": {
         "type": "raster",
         "url": "pmtiles:///sources/waiheke_island.pmtiles",
         "tileSize": 512
      },
      "te-ara-hura": {
         "type": "geojson",
         "data": "sources/te_ara_hura.geojson"
      }
  },
  "layers": [
    // ... existing Protomaps layers ...
  ]
}
</code></pre>
</li>
<li>
<p><strong>Add your trail layer</strong> just inside the closing square bracket <code>]</code> just above glyph and sprite lines. This bracket is the end of the list of style layers. With the trail style added it should look like this:</p>
<pre><code class="language-json">[
     {   // end of the style layer places_country
     },  // be sure to add a comma after this bracket if there isn't one
   {
      "id": "trail-line",
      "type": "line",
      "source": "te-ara-hura",
      "paint": {
            "line-color": "#e41f18",
            "line-width": 3,
            "line-dasharray": [2, 2]
      }
   }
],
</code></pre>
</li>
<li>
<p><strong>Save <code>protomaps.5.7.0.json</code> with your modifications as <code>style.json</code></strong>. this will overwrite the previous stylesheet now that you've moved everything into the larger file.</p>
</li>
</ol>
<p>You can delete <code>protomaps.5.7.0.json</code>. You do not need it anymore.</p>
<h3>Test Your Map</h3>
<ol>
<li>
<p><strong>Check to make sure your local server is still running</strong>, if not type <code>caddy run</code> in a terminal window (from your repository root directory).</p>
</li>
<li>
<p><strong>Refresh your browser</strong>: Go to <code>http://127.0.0.1:1234/index.html</code></p>
</li>
<li>
<p><strong>You should see</strong>:</p>
<ul>
<li>The Protomaps basemap (roads, labels, landcover)</li>
<li>Proper styling with icons and fonts</li>
<li>The Te Ara Hura trail displayed on top</li>
</ul>
</li>
</ol>
<h3>Troubleshooting</h3>
<p><strong>Map doesn't load?</strong></p>
<ul>
<li>Check developer console for errors</li>
<li>Verify <code>style.json</code> exists in root directory</li>
<li>Verify file paths in stylesheet are correct</li>
</ul>
<p><strong>PMTiles not loading?</strong></p>
<ul>
<li>Verify <code>sources/waiheke_island.pmtiles</code> exists</li>
<li>Check that PMTiles protocol is initialized in <code>index.js</code></li>
<li>Verify the PMTiles URL in <code>style.json</code> uses <code>pmtiles://</code> protocol</li>
</ul>
<h3>Verify Your Directory Structure</h3>
<p>You should now have all the files you need to render the map. Double-check it looks like this:</p>
<pre><code>standalone_web_maps_foss4g2025/
├── README.md                    # This file
├── Makefile                     # Build and serve commands (uses Caddy)
├── index.html                   # Main HTML file for the web map (contains inline CSS and JavaScript)
├── style.json                   # Source and style for Te Ara Hura and the Protomaps tile layers, fonts and sprites
├── lib/                         # Third-party libraries (self-contained)
└── sources/                     # Source data files
    ├── waiheke_island.pmtiles   # PMTiles archive for Waiheke Island basemap - added in later steps
    └── te_ara_hura.geojson      # GeoJSON file for Te Ara Hura trail
</code></pre>
<h3>Commit Your Changes</h3>
<p>Add, commit, and push your revised <code>index.html</code> and <code>style.json</code> to your remote fork. Verify that the map you see via your local server and the one you see via Github Pages match the image below.</p>
<h3>What You Have Now</h3>
<p>At the end of this step, you should have:</p>
<ul>
<li><code>style.json</code> - Protomaps bassemap styls and your trail layer style</li>
<li>Map displaying Protomaps basemap with your trail layer</li>
</ul>

        
          <div class="map-preview-container">
  <h2>Your Map Preview</h2>
  <div class="map-preview-wrapper">
    <img src="../images/step-06.png" alt="Map preview showing expected result at this stage" class="map-preview-image" style="max-width: 100%; height: auto; border: 1px solid #dee2e6; border-radius: 4px;">
    
      <p class="map-note">This is what your map should look like when you view it locally and via your Github Pages website</p>
    
  </div>
</div>


        
        
        <hr>
<p><strong><a href="../step-05/">← Previous: Step 5</a> | <a href="../step-07/">Next: Step 7 - Add Terrain →</a></strong></p>
      </article>
    </main>
  </div>

  <footer class="workshop-footer">
    <p>FOSS4G 2025 Workshop - <a rel="noreferrer" target="_blank" href="https://talks.osgeo.org/foss4g-2025/speaker/7A883D/">Stephanie May</a></p>
    <p class="footer-attribution">
      Background image: <a rel="noreferrer" target="_blank" href="https://www.flickr.com/photos/4nitsirk/5624277298" title="The sun returns to Waiheke Island">The sun returns to Waiheke Island</a> by <a rel="noreferrer" target="_blank" href="https://www.flickr.com/photos/4nitsirk/">Kristina D.C. Hoeppner</a>, <a target="_blank" href="https://creativecommons.org/licenses/by-sa/2.0/deed.en" rel="noreferrer">CC BY-SA 2.0</a>
    </p>
  </footer>

  <script>
    // Toggle sidebar on mobile
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarContent = document.getElementById('sidebarContent');
    
    if (sidebarToggle && sidebarContent) {
      sidebarToggle.addEventListener('click', function() {
        const sidebar = sidebarContent.closest('.workshop-sidebar');
        if (sidebar) {
          sidebar.classList.toggle('open');
        }
        sidebarContent.classList.toggle('open');
        sidebarToggle.classList.toggle('active');
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        if (window.innerWidth <= 768) {
          if (!sidebarContent.contains(event.target) && !sidebarToggle.contains(event.target)) {
            sidebarContent.classList.remove('open');
            sidebarToggle.classList.remove('active');
          }
        }
      });
    }
  </script>
</body>
</html>

